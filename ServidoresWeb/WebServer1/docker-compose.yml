# DOCKER-COMPOSE - WEBSERVER1

version: "3.8"

services:
  # -------------------------
  # Contenedor web1
  # -------------------------
  web1:
    build: .                                # Construye la imagen usando el Dockerfile
    container_name: web1                    # Nombre del contenedor
    hostname: web1                          # Nombre de host interno
    ports:
      - "8080:80"                           # Expone el puerto 80 del contenedor en el 8080 del host
    volumes:
      - ./web1/app:/var/www/html            # Monta el código de la aplicación
    restart: always                         # Reinicia automáticamente
    labels:
      - "traefik.enable=true"               # Habilita Traefik
      - "traefik.http.routers.web1.rule=Host(`192.168.1.100`)"   # Regla: VIP compartida
      - "traefik.http.routers.web1.entrypoints=websecure"        # Solo HTTPS
      - "traefik.http.routers.web1.tls=true"                     # TLS activado

  # -------------------------
  # Contenedor web2
  # -------------------------
  web2:
    build: .                                # Construye la imagen usando el mismo Dockerfile
    container_name: web2                    # Nombre del contenedor
    hostname: web2                          # Nombre de host interno
    ports:
      - "8081:80"                           # Expone el puerto 80 del contenedor en el 8080 del host
    volumes:
      - ./web2/app:/var/www/html            # Monta el código de la aplicación
    restart: always                         # Reinicia automáticamente
    labels:
      - "traefik.enable=true"               # Habilita Traefik
      - "traefik.http.routers.web2.rule=Host(`192.168.1.100`)"       # Regla: VIP compartida
      - "traefik.http.routers.web2.entrypoints=websecure"            # Solo HTTPS
      - "traefik.http.routers.web2.tls=true"                         # TLS activado

  # -------------------------
  # SQL Server (para sesiones y datos)
  # -------------------------
  db:
    image: mcr.microsoft.com/mssql/server:2022-latest   # Imagen oficial de SQL Server 2022
    container_name: sqlserver
    environment:
      - ACCEPT_EULA=Y                                   # Acepta licencia
      - SA_PASSWORD=Abcd1234.                           # Contraseña del usuario SA
    ports:
      - "1433:1433"                                     # Puerto estándar de SQL Server
    restart: always
